<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ÈÄ±ÈñìÊ¥ªÂãïÂÜÖË®≥</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      max-width: 1000px;
      margin: auto;
      background: #f5f6fa;
      color: #333;
      padding: 15px;
      box-sizing: border-box;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #4a90e2;
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    header h1 {
      font-size: 1.4em;
      margin: 0;
    }
    .top-icons a {
      margin-left: 10px;
      color: white;
      font-size: 1.4em;
      text-decoration: none;
      padding: 5px;
    }
    .week-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .week-navigation button {
      background: #6c757d;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.2s;
    }
    .week-navigation button:hover {
      background: #5a6268;
    }
    #weekDisplay {
      font-weight: bold;
    }

    /* ÈÄ±Ë°®Á§∫„ÉÜ„Éº„Éñ„É´„ÅÆ„Çπ„Çø„Ç§„É´ */
    #weeklyTableContainer {
      overflow-x: auto; /* Ê®™„Çπ„ÇØ„É≠„Éº„É´„ÇíÂèØËÉΩ„Å´„Åô„Çã */
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      padding: 10px;
    }
    #weeklyTable {
      width: 100%;
      border-collapse: collapse; /* „Çª„É´„ÅÆÂ¢ÉÁïåÁ∑ö„ÇíÁµêÂêà */
      min-width: 900px; /* „Çπ„Éû„Éõ„ÅßÊ®™„Çπ„ÇØ„É≠„Éº„É´„Åï„Åõ„Çã„Åü„ÇÅ„ÅÆÊúÄÂ∞èÂπÖ„ÇíË™øÊï¥ */
      table-layout: fixed; /* ÂàóÂπÖ„ÇíÂõ∫ÂÆö„Åó„Å¶Ê†ºÂ≠êÁä∂„Çí‰øù„Å§ */
    }
    /* „Åô„Åπ„Å¶„ÅÆth/td„Å´Âü∫Êú¨„ÅÆÁΩ´Á∑ö„ÇíÈÅ©Áî® */
    #weeklyTable th,
    #weeklyTable td {
      border: 1px solid #eee; /* Âü∫Êú¨„ÅÆÁΩ´Á∑ö */
      box-sizing: border-box; /* „Éë„Éá„Ç£„É≥„Ç∞„Å®„Éú„Éº„ÉÄ„Éº„ÇíÂπÖ„Å´Âê´„ÇÅ„Çã */
      vertical-align: top; /* ‰∏äÊèÉ„Åà */
      padding: 0; /* „Çª„É´Ëá™‰Ωì„ÅÆ„Éë„Éá„Ç£„É≥„Ç∞„Çí„É™„Çª„ÉÉ„Éà */
    }

    /* ÊôÇÈñìÂàó„ÅÆ„Çπ„Çø„Ç§„É´ */
    #weeklyTable th:first-child,
    #weeklyTable td:first-child {
      width: 4%; /* ÊôÇÈñìÂàó„ÅÆÂπÖ */
      min-width: 40px; /* ÊúÄÂ∞èÂπÖ */
      white-space: nowrap;
      text-align: center;
      background-color: #f8f8f8; /* ÊôÇÈñìÂàó„ÅÆËÉåÊôØËâ≤ */
      padding: 4px 8px; /* ÊôÇÈñìÂàó„Å´„ÅÆ„Åø„Éë„Éá„Ç£„É≥„Ç∞„ÇíË®≠ÂÆö */
    }

    /* Êó•‰ªò„Éò„ÉÉ„ÉÄ„ÉºË°å„ÅÆ„Çª„É´ (Êó•‰ªò„ÇíË°®Á§∫) */
    #weeklyTable #dateRow th {
        text-align: center;
        font-size: 0.9em;
        font-weight: bold;
        padding: 4px 0; /* ‰∏ä‰∏ã„Éë„Éá„Ç£„É≥„Ç∞ */
        width: calc(96% / 7); /* ÊôÇÈñìÂàó„ÇíÈô§„ÅÑ„ÅüÊÆã„Çä„Çí7Êó•„ÅßÂùáÁ≠â„Å´ÂàÜÂâ≤ */
    }

    /* „Çµ„Éñ„Éò„ÉÉ„ÉÄ„ÉºË°å„ÅÆ„Çª„É´ („ÇÑ„Å£„Åü„Åì„Å®„ÄÅÊ∞óÂàÜ„ÄÅÁñ≤Âä¥Â∫¶) */
    #weeklyTable #subHeaderRow th {
        padding: 0; /* Ë¶™th„ÅÆ„Éë„Éá„Ç£„É≥„Ç∞„Çí„É™„Çª„ÉÉ„Éà */
        border-top: none; /* ‰∏äÁΩ´Á∑ö„ÅØdateRow„ÅÆth„Å´„ÅÇ„Çã„ÅÆ„Åß‰∏çË¶Å */
        border-bottom: 1px solid #eee; /* ‰∏ãÁΩ´Á∑ö */
        width: calc(96% / 7); /* ÊôÇÈñìÂàó„ÇíÈô§„ÅÑ„ÅüÊÆã„Çä„Çí7Êó•„ÅßÂùáÁ≠â„Å´ÂàÜÂâ≤ */
    }
    #weeklyTable #subHeaderRow th > div {
        display: flex;
        width: 100%;
        height: 100%;
    }
    #weeklyTable #subHeaderRow .col-header {
      flex-grow: 1;
      text-align: center;
      padding: 4px 0px;
      font-size: 0.8em; /* „Éò„ÉÉ„ÉÄ„Éº„ÅÆÊñáÂ≠ó„ÇíÂ∞ë„ÅóÂ∞è„Åï„Åè */
      font-weight: normal;
      box-sizing: border-box;
      position: relative; /* Êì¨‰ººË¶ÅÁ¥†„ÅÆÂü∫Ê∫ñ„Å´ */
    }
    /* „Çµ„ÉñÂàó„ÅÆÈñì„ÅÆÁ†¥Á∑öÔºà„Éò„ÉÉ„ÉÄ„ÉºÔºâ- Êì¨‰ººË¶ÅÁ¥†„ÅßÊèèÁîª */
    #weeklyTable #subHeaderRow .col-activity::after,
    #weeklyTable #subHeaderRow .col-mood::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        height: 100%;
        border-right: 1px dashed #ccc;
    }

    /* ÂêÑÊõúÊó•„ÅÆ„Çµ„ÉñÂàó„ÅÆÂπÖ (ÂêàË®à100%„Å´„Å™„Çã„Çà„ÅÜ„Å´Ë™øÊï¥) */
    #weeklyTable .col-activity { width: 69.2%; } /* 9/13 = Á¥Ñ69.2% */
    #weeklyTable .col-mood { width: 15.4%; } /* 2/13 = Á¥Ñ15.4% */
    #weeklyTable .col-fatigue { width: 15.4%; } /* 2/13 = Á¥Ñ15.4% */

    /* ÂêÑÊôÇÈñìÂ∏Ø„ÅÆ„Éá„Éº„Çø„Çª„É´ */
    #weeklyTable td.day-cell {
      display: flex; /* ÂÜÖÈÉ®„ÅÆdiv„ÇíÊ®™‰∏¶„Å≥„Å´„Åô„Çã */
      width: calc(96% / 7); /* 7Êó•ÂàÜ„ÅÆÂùáÁ≠âÂπÖ */
      min-height: 50px; /* ÂêÑÊôÇÈñìÂ∏Ø„Çª„É´„ÅÆÊúÄÂ∞èÈ´ò„Åï */
    }
    #weeklyTable td.day-cell > div {
      flex-grow: 1;
      padding: 4px 8px;
      box-sizing: border-box;
      overflow: hidden;
      text-overflow: ellipsis;
      word-wrap: break-word;
      min-height: 42px; /* ÂÜÖÂÆπ„Åå„Å™„ÅÑÂ†¥Âêà„Åß„ÇÇÈ´ò„Åï„ÇíÁ¢∫‰øù */
      white-space: pre-wrap; /* ÊîπË°å„Çí‰øùÊåÅ„Åó„ÄÅÂøÖË¶Å„Å´Âøú„Åò„Å¶Êäò„ÇäËøî„Åô */
      position: relative; /* Êì¨‰ººË¶ÅÁ¥†„ÅÆÂü∫Ê∫ñ„Å´ */
    }
    /* „Çµ„ÉñÂàó„ÅÆÈñì„ÅÆÁ†¥Á∑öÔºà„Éá„Éº„Çø„Çª„É´Ôºâ- Êì¨‰ººË¶ÅÁ¥†„ÅßÊèèÁîª */
    #weeklyTable td.day-cell .col-activity::after,
    #weeklyTable td.day-cell .col-mood::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        height: 100%;
        border-right: 1px dashed #ccc;
    }

    #weeklyTable td.day-cell .col-mood,
    #weeklyTable td.day-cell .col-fatigue {
      text-align: right; /* Êï∞ÂÄ§„ÅØÂè≥ÂØÑ„Åõ„ÅßË¶ã„ÇÑ„Åô„Åè */
    }
    .mood-fatigue-value {
        font-weight: bold;
        color: #2c3e50;
    }
    /* Áù°Áú†‰∏≠„ÅÆË°®Á§∫„Çí„Ç≥„É≥„Éë„ÇØ„Éà„Å´„Åô„Çã„Åü„ÇÅ„ÅÆ„Çπ„Çø„Ç§„É´ */
    .sleep-entry {
        font-style: italic;
        color: #888;
    }

    /* ÂÇôËÄÉÊ¨Ñ„ÅÆ„Çπ„Çø„Ç§„É´ */
    .daily-summary {
      font-size: 0.8em;
      color: #666;
      padding: 4px 8px;
      box-sizing: border-box;
      min-height: 50px; /* ÊúÄÂ∞èÈ´ò„Åï„ÇíÁ¢∫‰øù */
      white-space: pre-wrap;
    }
    /* ÂÇôËÄÉÊ¨Ñ„ÅÆ„Çª„É´ÂÖ®‰Ωì */
    #weeklyTable td.daily-summary-cell {
      width: calc(96% / 7); /* 7Êó•ÂàÜ„ÅÆÂùáÁ≠âÂπÖ */
      border-top: none; /* ‰∏äÁΩ´Á∑ö„ÅØÊôÇÈñì„Çª„É´„ÅÆ‰∏ãÁΩ´Á∑ö„Å´„ÅÇ„Çã„ÅÆ„Åß‰∏çË¶Å */
      background-color: #f8f8f8; /* ÂÇôËÄÉÊ¨Ñ„ÅÆËÉåÊôØËâ≤„ÇíÂ∞ë„ÅóÂ§â„Åà„Çã */
    }
    #weeklyTable tbody tr:last-child th {
        background-color: #f8f8f8; /* ÂÇôËÄÉÊ¨Ñ„ÅÆÊôÇÈñì„Éò„ÉÉ„ÉÄ„Éº„ÇÇËâ≤„ÇíÂêà„Çè„Åõ„Çã */
    }

    /* Âç∞Âà∑Áî®„Çπ„Çø„Ç§„É´ (Ê®™Èï∑A4„Çµ„Ç§„Ç∫Ë™øÊï¥) */
    @media print {
      body {
        margin: 0 !important;
        padding: 4mm 5.94mm 4mm 8.91mm !important;
        max-width: none !important;
        width: 297mm !important;
        height: 210mm !important;
        overflow: hidden !important;
        display: block !important;
        box-sizing: border-box !important;
        background-color: white !important;
      }
      header, .week-navigation, .top-icons {
        display: none !important;
      }
      #weeklyTableContainer {
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        width: 100% !important;
        height: 100% !important;
        display: block !important;
        overflow: visible !important;
        box-sizing: border-box !important;
      }
      #weeklyTable {
        width: 100% !important;
        height: 100% !important;
        border-collapse: collapse !important;
        table-layout: fixed !important;
        font-size: 0.5em !important;
      }

      /* Âç∞Âà∑ÊôÇ„ÅÆ„Åô„Åπ„Å¶„ÅÆth/td„Å´Âü∫Êú¨„ÅÆÁΩ´Á∑ö„ÇíÈÅ©Áî® */
      #weeklyTable th,
      #weeklyTable td {
        border: 0.2mm solid #eee !important; /* Âç∞Âà∑ÊôÇ„ÅÆÁΩ´Á∑ö„ÇÇ„Éü„É™„É°„Éº„Éà„É´Âçò‰Ωç„Å´ */
        padding: 0 !important;
        vertical-align: top !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
      }

      /* ÂàóÂπÖ„ÅÆË™øÊï¥ */
      #weeklyTable thead tr th:first-child,
      #weeklyTable tbody tr td:first-child {
        width: 4% !important;
        min-width: 0 !important;
        padding: 0.5mm 1mm !important;
        background-color: #f8f8f8 !important;
      }
      /* ÂêÑÊõúÊó•„ÅÆ„Çª„É´ÔºàÂÖ®‰ΩìÔºâ */
      #weeklyTable #dateRow th,
      #weeklyTable #subHeaderRow th,
      #weeklyTable tbody tr td.day-cell,
      #weeklyTable td.daily-summary-cell {
        width: calc(96% / 7) !important;
        min-width: 0 !important;
        padding: 0 !important;
      }

      /* Âç∞Âà∑ÊôÇ„ÅÆ„Çµ„ÉñÂàó„ÅÆÂπÖ */
      #weeklyTable .col-activity { width: 69.2% !important; }
      #weeklyTable .col-mood { width: 15.4% !important; }
      #weeklyTable .col-fatigue { width: 15.4% !important; }

      /* Âç∞Âà∑ÊôÇ„ÅÆ„Çµ„ÉñÂàó„ÅÆÈñì„ÅÆÁ†¥Á∑öÔºàÊì¨‰ººË¶ÅÁ¥†Ôºâ */
      #weeklyTable #subHeaderRow .col-activity::after,
      #weeklyTable #subHeaderRow .col-mood::after,
      #weeklyTable td.day-cell .col-activity::after,
      #weeklyTable td.day-cell .col-mood::after {
          border-right: 0.2mm dashed #ddd !important;
      }

      /* Ë°åÈ´ò„ÅÆË™øÊï¥ */
      #weeklyTable thead tr { height: 3% !important; }
      #weeklyTable tbody tr { height: calc(97% / 25) !important; }

      /* Âç∞Âà∑ÊôÇ„ÅÆ„Çª„É´ÂÜÖË¶ÅÁ¥†„ÅÆ„Çπ„Çø„Ç§„É´Ë™øÊï¥ */
      #weeklyTable #subHeaderRow .col-header,
      #weeklyTable td.day-cell > div {
          padding: 0.5mm 1mm !important;
          line-height: 1 !important;
          font-size: 0.9em !important;
          min-height: 0 !important;
          white-space: pre-wrap !important;
      }
      #weeklyTable td .mood-fatigue-value {
          font-size: 0.9em !important;
      }
      .daily-summary {
          padding: 0.5mm 1mm !important;
          font-size: 0.8em !important;
          min-height: 0 !important;
          white-space: pre-wrap !important;
      }
      #weeklyTable tbody tr:last-child td,
      #weeklyTable tbody tr:last-child th {
          background-color: #f8f8f8 !important;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ÈÄ±ÈñìË°®Á§∫</h1>
    <div class="top-icons">
      <a href="index.html" title="Ê¥ªÂãïË®òÈå≤">‚úèÔ∏è</a>
      <a href="#" id="saveImageBtn" title="ÁîªÂÉè„Çí‰øùÂ≠ò">üì∑</a>
    </div>
  </header>

  <div class="week-navigation">
    <button id="prevWeekBtn">‚Üê Ââç„ÅÆÈÄ±</button>
    <span id="weekDisplay"></span>
    <button id="nextWeekBtn">Ê¨°„ÅÆÈÄ± ‚Üí</button>
  </div>

  <div id="weeklyTableContainer">
    <table id="weeklyTable">
      <thead>
        <tr id="dateRow">
          <th>ÊôÇÈñì</th>
        </tr>
        <tr id="subHeaderRow">
          <th></th> </tr>
      </thead>
      <tbody id="weeklyTableBody">
      </tbody>
    </table>
  </div>

  <script>
    const daysOfWeek = ["Êó•", "Êúà", "ÁÅ´", "Ê∞¥", "Êú®", "Èáë", "Âúü"];
    const weeklyTableBody = document.getElementById('weeklyTableBody');
    const dateRow = document.getElementById('dateRow');
    const subHeaderRow = document.getElementById('subHeaderRow');
    const weekDisplay = document.getElementById('weekDisplay');
    const prevWeekBtn = document.getElementById('prevWeekBtn');
    const nextWeekBtn = document.getElementById('nextWeekBtn');
    const saveImageBtn = document.getElementById('saveImageBtn');

    let currentMonday = getMonday(new Date());

    function getMonday(date) {
        const d = new Date(date);
        const day = d.getUTCDay();
        const diff = d.getUTCDate() - day + (day === 0 ? -6 : 1);
        d.setUTCDate(diff);
        d.setUTCHours(0, 0, 0, 0);
        return d;
    }

    function formatDate(date) {
      const localDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
      const month = (localDate.getMonth() + 1).toString().padStart(2, '0');
      const day = localDate.getDate().toString().padStart(2, '0');
      const dayOfWeek = daysOfWeek[localDate.getDay()];
      return `${month}/${day}(${dayOfWeek})`;
    }

    function updateWeekDisplay() {
      const sunday = new Date(currentMonday);
      sunday.setUTCDate(currentMonday.getUTCDate() + 6);
      weekDisplay.textContent = `${formatDate(currentMonday)} - ${formatDate(sunday)}`;
    }

    function renderWeeklyTable() {
      dateRow.innerHTML = '<th>ÊôÇÈñì</th>';
      subHeaderRow.innerHTML = '<th></th>';
      weeklyTableBody.innerHTML = '';

      const datesInWeek = [];
      for (let i = 0; i < 7; i++) {
        const date = new Date(currentMonday);
        date.setUTCDate(currentMonday.getUTCDate() + i);
        datesInWeek.push(date);

        // Êó•‰ªò„Éò„ÉÉ„ÉÄ„Éº
        const thDate = document.createElement('th');
        thDate.classList.add('day-header'); // „ÇØ„É©„Çπ„ÇíËøΩÂä†
        thDate.setAttribute('colspan', '3'); // 3„Å§„ÅÆ„Çµ„ÉñÂàó„Å´„Åæ„Åü„Åå„Çã
        thDate.textContent = formatDate(date);
        dateRow.appendChild(thDate);

        // ÂêÑÊõúÊó•„ÅÆ„Çµ„Éñ„Éò„ÉÉ„ÉÄ„Éº
        const thSub = document.createElement('th');
        thSub.classList.add('day-header'); // „ÇØ„É©„Çπ„ÇíËøΩÂä†
        thSub.innerHTML = `
          <div class="col-activity col-header">„ÇÑ„Å£„Åü„Åì„Å®</div>
          <div class="col-mood col-header">Ê∞óÂàÜ</div>
          <div class="col-fatigue col-header">Áñ≤Âä¥Â∫¶</div>
        `;
        subHeaderRow.appendChild(thSub);
      }

      for (let i = 0; i < 24; i++) {
        const hour = (i + 4) % 24;
        const timeKey = hour.toString().padStart(2, '0');
        
        const tr = document.createElement('tr');
        const timeCell = document.createElement('td');
        timeCell.textContent = `${timeKey}:00`;
        tr.appendChild(timeCell);

        datesInWeek.forEach(date => {
          const td = document.createElement('td');
          td.classList.add('day-cell');
          const dateStr = date.toISOString().split('T')[0];
          const dailyData = JSON.parse(localStorage.getItem(dateStr) || '{}');
          const entry = dailyData[timeKey];

          const activityDiv = document.createElement('div');
          activityDiv.className = 'col-activity';
          const moodDiv = document.createElement('div');
          moodDiv.className = 'col-mood mood-fatigue-value';
          const fatigueDiv = document.createElement('div');
          fatigueDiv.className = 'col-fatigue mood-fatigue-value';

          if (entry) {
            const isSleeping = entry.activity.includes("Áù°Áú†");

            activityDiv.textContent = entry.activity.join(', ');

            if (!isSleeping) {
              moodDiv.textContent = (entry.mood === '' || entry.mood === null) ? '' : entry.mood;
              fatigueDiv.textContent = (entry.fatigue === '' || entry.fatigue === null) ? '' : entry.fatigue;
            } else {
              activityDiv.classList.add('sleep-entry');
              moodDiv.classList.add('sleep-entry');
              fatigueDiv.classList.add('sleep-entry');
              moodDiv.textContent = '';
              fatigueDiv.textContent = '';
            }
            
            if (entry.free) {
                activityDiv.textContent += (activityDiv.textContent ? '\n' : '') + `„É°„É¢: ${entry.free}`;
            }
          }

          td.appendChild(activityDiv);
          td.appendChild(moodDiv);
          td.appendChild(fatigueDiv);
          tr.appendChild(td);
        });
        weeklyTableBody.appendChild(tr);
      }

      const dailyNoteTr = document.createElement('tr');
      const dailyNoteHeader = document.createElement('th');
      dailyNoteHeader.textContent = 'ÂÇôËÄÉ';
      dailyNoteTr.appendChild(dailyNoteHeader);

      datesInWeek.forEach(date => {
        const td = document.createElement('td');
        td.classList.add('daily-summary-cell');
        td.setAttribute('colspan', '3');
        const dateStr = date.toISOString().split('T')[0];
        const dailyData = JSON.parse(localStorage.getItem(dateStr) || '{}');
        const dailyNote = dailyData.dailyNote;

        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'daily-summary';

        let dailyNoteContent = [];
        if (dailyNote) {
            if (dailyNote.alcohol) { dailyNoteContent.push('„Éª„Ç¢„É´„Ç≥„Éº„É´ÊëÇÂèñ'); }
            if (dailyNote.caffeine) { dailyNoteContent.push('„Éª„Ç´„Éï„Çß„Ç§„É≥ÊëÇÂèñ'); }
            if (dailyNote.intakeMemo) { dailyNoteContent.push(`„ÉªÊëÇÂèñÁä∂Ê≥Å: ${dailyNote.intakeMemo}`); }
            if (dailyNote.memo) { dailyNoteContent.push(`„ÉªÊó•„É°„É¢: ${dailyNote.memo}`); }
        }
        if (dailyNoteContent.length > 0) {
            summaryDiv.textContent = dailyNoteContent.join('\n');
        }
        td.appendChild(summaryDiv);
        dailyNoteTr.appendChild(td);
      });
      weeklyTableBody.appendChild(dailyNoteTr);

      updateWeekDisplay();
    }

    prevWeekBtn.addEventListener('click', () => {
      currentMonday.setUTCDate(currentMonday.getUTCDate() - 7);
      renderWeeklyTable();
    });

    nextWeekBtn.addEventListener('click', () => {
      currentMonday.setUTCDate(currentMonday.getUTCDate() + 7);
      renderWeeklyTable();
    });

    saveImageBtn.addEventListener('click', async (e) => {
        e.preventDefault();

        const element = document.body;

        const printStyle = document.createElement('style');
        printStyle.id = 'print-style-for-capture';

        const a4WidthMm = 297;
        const a4HeightMm = 210;

        const paddingLeftMm = a4WidthMm * 0.03;
        const paddingRightMm = a4WidthMm * 0.02;
        const paddingTopBottomMm = 4;

        printStyle.innerHTML = `
            body {
                margin: 0 !important;
                padding: ${paddingTopBottomMm}mm ${paddingRightMm}mm ${paddingTopBottomMm}mm ${paddingLeftMm}mm !important;
                max-width: none !important;
                width: ${a4WidthMm}mm !important;
                height: ${a4HeightMm}mm !important;
                overflow: hidden !important;
                display: block !important;
                box-sizing: border-box !important;
                background-color: white !important;
            }
            header, .week-navigation, .top-icons {
                display: none !important;
            }
            #weeklyTableContainer {
                border: none !important;
                box-shadow: none !important;
                padding: 0 !important;
                width: 100% !important;
                height: 100% !important;
                display: block !important;
                overflow: visible !important;
                box-sizing: border-box !important;
            }
            #weeklyTable {
                width: 100% !important;
                height: 100% !important;
                border-collapse: collapse !important;
                table-layout: fixed !important;
                font-size: 0.5em !important;
            }

            /* Âç∞Âà∑ÊôÇ„ÅÆ„Åô„Åπ„Å¶„ÅÆth/td„Å´Âü∫Êú¨„ÅÆÁΩ´Á∑ö„ÇíÈÅ©Áî® */
            #weeklyTable th,
            #weeklyTable td {
                border: 0.2mm solid #eee !important;
                padding: 0 !important;
                vertical-align: top !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }

            /* ÂàóÂπÖ„ÅÆË™øÊï¥ */
            #weeklyTable thead tr th:first-child,
            #weeklyTable tbody tr td:first-child {
                width: 4% !important;
                min-width: 0 !important;
                padding: 0.5mm 1mm !important;
                background-color: #f8f8f8 !important;
            }
            /* ÂêÑÊõúÊó•„ÅÆ„Çª„É´ÔºàÂÖ®‰ΩìÔºâ */
            #weeklyTable #dateRow th,
            #weeklyTable #subHeaderRow th,
            #weeklyTable tbody tr td.day-cell,
            #weeklyTable td.daily-summary-cell {
                width: calc(96% / 7) !important;
                min-width: 0 !important;
                padding: 0 !important;
            }

            /* Âç∞Âà∑ÊôÇ„ÅÆ„Çµ„ÉñÂàó„ÅÆÂπÖ */
            #weeklyTable .col-activity { width: 69.2% !important; }
            #weeklyTable .col-mood { width: 15.4% !important; }
            #weeklyTable .col-fatigue { width: 15.4% !important; }

            /* Âç∞Âà∑ÊôÇ„ÅÆ„Çµ„ÉñÂàó„ÅÆÈñì„ÅÆÁ†¥Á∑öÔºàÊì¨‰ººË¶ÅÁ¥†Ôºâ */
            #weeklyTable #subHeaderRow .col-activity::after,
            #weeklyTable #subHeaderRow .col-mood::after,
            #weeklyTable td.day-cell .col-activity::after,
            #weeklyTable td.day-cell .col-mood::after {
                border-right: 0.2mm dashed #ddd !important;
            }

            /* Ë°åÈ´ò„ÅÆË™øÊï¥ */
            #weeklyTable thead tr { height: 3% !important; }
            #weeklyTable tbody tr { height: calc(97% / 25) !important; }

            /* Âç∞Âà∑ÊôÇ„ÅÆ„Çª„É´ÂÜÖË¶ÅÁ¥†„ÅÆ„Çπ„Çø„Ç§„É´Ë™øÊï¥ */
            #weeklyTable #subHeaderRow .col-header,
            #weeklyTable td.day-cell > div {
                padding: 0.5mm 1mm !important;
                line-height: 1 !important;
                font-size: 0.9em !important;
                min-height: 0 !important;
                white-space: pre-wrap !important;
            }
            #weeklyTable td .mood-fatigue-value {
                font-size: 0.9em !important;
            }
            .daily-summary {
                padding: 0.5mm 1mm !important;
                font-size: 0.8em !important;
                min-height: 0 !important;
                white-space: pre-wrap !important;
            }
            #weeklyTable tbody tr:last-child td,
            #weeklyTable tbody tr:last-child th {
                background-color: #f8f8f8 !important;
            }
        `;
        document.head.appendChild(printStyle);

        const canvas = await html2canvas(element, {
            scale: 2,
            useCORS: true,
            windowWidth: element.scrollWidth,
            windowHeight: element.scrollHeight,
            x: 0,
            y: 0,
            width: element.offsetWidth,
            height: element.offsetHeight,
        });

        const dpi = 300;
        const mmPerInch = 25.4;
        const a4LandscapeWidthPx = (a4WidthMm / mmPerInch) * dpi;
        const a4LandscapeHeightPx = (a4HeightMm / mmPerInch) * dpi;

        const outputCanvas = document.createElement('canvas');
        outputCanvas.width = a4LandscapeWidthPx;
        outputCanvas.height = a4LandscapeHeightPx;
        const ctx = outputCanvas.getContext('2d');

        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, outputCanvas.width, outputCanvas.height);

        ctx.drawImage(canvas, 0, 0, a4LandscapeWidthPx, a4LandscapeHeightPx);

        const imgData = outputCanvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.href = imgData;
        link.download = `weekly_report_${currentMonday.toISOString().split('T')[0]}_A4L.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        const styleToRemove = document.getElementById('print-style-for-capture');
        if (styleToRemove) {
            document.head.removeChild(styleToRemove);
        }

        document.body.style.cssText = '';
    });

    renderWeeklyTable();
  </script>
</body>
</html>
